<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>外卖选择</title>



		<link rel="stylesheet" type="text/css" href="css/choose_meal/aui.css">
		<link rel="stylesheet" href="css/choose_meal/classify.css">

		<style>
			html,body{height: 100%;max-width: 640px;margin:0 auto;}
			.aui-bar-nav{border:none;background: #f5f5f5;}
			.main{height: calc(100% - 4.5rem);}

			#tab1-con1{padding-bottom: 3rem;}
			#tab1-con1,#tab1-con2{height: 100%;}
			.aui-tab{border-bottom: solid 1px #eee;background: #f5f5f5;height: 2.25rem;}
			.aui-tab-item{font-size: .75rem;color: #666;width: 25%;}
			.aui-tab-item.aui-active{border:none;color: #000;position: relative;}
			.aui-tab-item.aui-active:after{position: absolute;left: 40%;width: 20%;height: 2px;background: #00ae66;content: '';bottom:0;}
		</style>


		<script src="js/jquery.min.js"></script>
		<script type="text/javascript" src="js/add.js" ></script>
		<script type="text/javascript" src="js/api.js"></script>
		<script type="text/javascript" src="js/aui-tab.js" ></script>
		<script type="text/javascript" src="script/menu.js"></script>
		<script type="text/javascript">
			$(function () {

				$("#left li:first-child").addClass("active");
				var e;
				//商品点击增加
				$(".add").click(function(){
					alert("asdasd");
					var n = $(this).prev().text();
					var num = parseFloat(n)+1;
					e = $(this).prev();//当前数量
					var ms = e.text(num-1);
					if(ms!=0){      //判断是否显示减号及数量
						e.css("display","inline-block");
						e.prev().css("display","inline-block")
					}
					e.text(num); //设置数量
					var parent = $(this).parent();
					var m=parent.parent().children("h4").text(); //当前商品名称
					var danjia=$(this).next().text(); //获取单价
					var a = $("#totalpriceshow").html();  //获取当前所选总价
					$("#totalpriceshow").html((a * 1 + danjia * 1).toFixed(2));//计算当前所选总价
					var nm = $("#totalcountshow").html(); //获取数量
					$("#totalcountshow").html(nm*1+1);
					jss();   //改变按钮样式

					var acount =num;
					var sum = (danjia*acount).toFixed(2);
					var price =danjia;
					//判断购物车里是否有商品，是否有相同规格的商品
					if($(".list-content ul li").length <= 0){
						var addtr = '<li class="food">';
						addtr += '<div><span class="accountName">'+m+'</span></div>';
						addtr += '<div><span>￥</span><span class="accountPrice">'+sum+'</span></div>'	;
						addtr += '<div class="btn">';
						addtr += '<button class="ms2" style="display: inline-block;"></button>';
						addtr += '<i class="li_acount">'+acount+'</i>';
						addtr += '<button class="ad2"></button>';
						addtr += '<i class="price" style="display: none;">'+price+'</i>';
						addtr += '</div>';
						addtr += '</li>';
						$(".list-content ul").append(addtr);
						return;
					}else{
						$(".list-content ul li").each(function(){
							if ($(this).find("span.accountName").html() == m) {
								var count = parseInt($(this).find(".li_acount").html());
								count = parseInt(num);
								$(this).find(".li_acount").html(count); //对商品的数量进行重新赋值
								$(this).find(".accountPrice").html((count*price).toFixed(2));//对商品的价格进行重新赋值
								flag = true;
								return false;
							}else {
								flag = false;
							}
						})
					}
					//如果为默认值也就是说里面没有此商品，所以添加此商品。
					if (flag == false) {
						var addtr = '<li class="food">';
						addtr += '<div><span class="accountName">'+m+'</span></div>';
						addtr += '<div><span>￥</span><span class="accountPrice">'+sum+'</span></div>'	;
						addtr += '<div class="btn">';
						addtr += '<button class="ms2" style="display: inline-block;"></button><i class="li_acount">'+acount+'</i><button class="ad2"></button><i class="price" style="display: none;">'+price+'</i>';
						addtr += '</div>';
						addtr += '</li>';
						$(".list-content ul").append(addtr);
					}

				});

				$(".minus").click(function(){
					$('.shopcart-list,.up1').show();
				});

				//购物车 - 加
				$(document).on('click','.ad2',function(){
					var n = parseInt($(this).prev().text())+1;
					$(this).prev().text(n);    //当前商品数量+1
					e.text(n);    //赋值给商品列表的数量
					var p = parseFloat($(this).next().text());    //隐藏的价格
					$(this).parent().prev().children("span.accountPrice").text((p*n).toFixed(2));  //计算该商品规格的总价值

					$("#totalcountshow").text(parseFloat($("#totalcountshow").text())+1);   //总数量＋1
					$("#totalpriceshow").text((parseFloat($("#totalpriceshow").text())+p).toFixed(2));   //总价加上该商品价格
				});

				//购物车 - 减
				$('.list-content').on('click','.ms2',function(){
					var e;
					var m = $(this).parent().parent().find(".accountName").text();  //当前商品名字
					var a = parseFloat($(this).siblings(".price").text());  //当前商品单价
					var n = parseInt($(this).next().text())-1;  //当前商品数量
					var s = parseFloat($("#totalpriceshow").text());  //总金额
					var znum=0;

					$(".list-content ul li").each(function(){
						znum = znum + parseInt($(this).find('.li_acount').text());
					})
					znum = znum-1;

					console.log(m);
					$('.right-con ul li').each(function(){
						console.log(11111);
						if(m==$(this).find('h4').text()){
							console.log(2222);
							e=$(this).find('.add').prev();
						}
					})
					if(n == 0){
						$(this).parent().parent().remove();

						e.css("display","none");
						e.prev().css("display","none")

						if(znum==0){
							$(".up1").hide();
						}
					}
					$(this).next().text(n);
					e.text(n);    //赋值给商品列表的数量
					$(this).parent().prev().children("span:nth-child(2)").text((a*n).toFixed(2));

					$("#totalcountshow").text(parseInt($("#totalcountshow").text())-1);
					$("#totalpriceshow").text((s-a).toFixed(2));
					if(parseFloat($("#totalcountshow").text())==0){
						$(".shopcart-list").hide();
					}
				});

				function jss() {
					var m = $("#totalcountshow").html();
					if (m > 0) {
						$(".right").find("a").removeClass("disable");
					} else {
						$(".right").find("a").addClass("disable");
					}
				};

				//选项卡
				$(".con>div").hide();
				$(".con>div:eq(0)").show();
				$(".left-menu li").click(function(){
					$(this).addClass("active").siblings().removeClass("active");
					var n = $(".left-menu li").index(this);
					$(".left-menu li").index(this);
					$(".con>div").hide();
					$(".con>div:eq("+n+")").show();
				});


				$(".footer>.left").click(function(){
					var content = $(".list-content>ul").html();
					if(content!=""){
						$(".shopcart-list.fold-transition").toggle();
						$(".up1").toggle();
					}
				});

				$(".up1").click(function(){
					$(".up1").hide();
					$(".shopcart-list.fold-transition").hide();
				})

				//清空购物车
				$(".empty").click(function(){
					$(".list-content>ul").html("");
					$("#totalcountshow").text("0");
					$("#totalpriceshow").text("0");
					$(".minus").next().text("0");
					$(".minus").hide();
					$(".minus").next().hide();
					$(".shopcart-list").hide();
					$(".up1").hide();
					jss();//改变按钮样式
				});
			});

		</script>

	</head>

	<body>

	<input id="Up_Btn" type="submit" value="提交"/>
		<header class="aui-bar aui-bar-nav">

			<a class="aui-pull-left aui-btn">
				<span  class="aui-iconfont aui-icon-left"></span>
			</a>
			<div class="aui-title">商品</div>
			<div class="aui-pull-right"></div>
		</header>
	<button onclick="f()">asdasd</button>
		<div class="aui-tab" id="tab">
			<div class="aui-tab-item aui-active">点菜</div>
		</div>

		<div class="main">
			<div class="aui-item" id="tab1-con1">
				<div class="left-menu" id="left">

					<ul>
							<li><span>米饭</span></li>
							<li><span>饮品</span></li>
							<li><span>肉类</span></li>
					</ul>
					</div>
					<div id="muns" class="con">


			</div>
		</div>
		</div>
	<div class="up1"></div>
	<div class="shopcart-list fold-transition">
		<div class="list-header">
			<h1 class="title">购物车</h1>
			<span class="empty">清空所有</span>
		</div>
		<div class="list-content">
			<ul></ul>
		</div>
	</div>
	<div class="footer">
		<div class="left">
			<div class="count_num"><span id="totalcountshow">0</span></div>
			<span id="cartN" class="nowrap">总计：<span id="totalpriceshow">0</span>元</span>
		</div>
		<div class="right">
			<a id="btnselect" class="xhlbtn disable">去结算</a>
		</div>
	</div>
	</div>
	<div class="aui-item aui-hide" id="tab1-con2">
		2
	</div>






	<script type="text/javascript">
		apiready = function() {
			api.parseTapmode();
		}
		var tab = new auiTab({
			element: document.getElementById("tab"),

		}, function(ret) {
			if (ret) {
				//定义获取对象的所有兄弟节点的函数，
				function siblings(elm) {
					var a = [];
					var p = elm.parentNode.children;
					for (var i = 0, pl = p.length; i < pl; i++) {
						if (p[i] !== elm) a.push(p[i]);
					}
					return a;
				}
				var index = ret.index;
				var activeC = document.getElementById("tab1-con" + index);
				activeC.className = "";
				for (var i = 0; i < siblings(activeC).length; i++) {
					siblings(activeC)[i].className = "aui-hide";
				}
			}
		});


	</script>

	</body>
</html>
